<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />

<link rel="stylesheet" href="/default/css/shared_rev.REVISION.css" type="text/css" media="screen" />
<!--[if lte IE 6]><link rel="stylesheet" type="text/css" media="screen" href="/default/css/ie6.css" /><![endif]-->
<!--[if gte IE 7]><link rel="stylesheet" type="text/css" media="screen" href="/default/css/ie7.css" /><![endif]-->

<meta http-equiv="content-language" content="en" />

<meta name="author" content="Content with Style" />
<meta name="copyright" content="Content with Style" />
<meta name="publisher" content="Content with Style" />

<meta name="robots" content="all" />
<meta name="revisit-after" content="2 days" />

<link rel="alternate" type="rss" href="/atom.xml" />
<link rel="shortcut icon" type="image/ico" href="/favicon.ico" />

<title>Content with Style - Processing the output buffer with XSLT</title>



        <link rel="stylesheet" title="Default" href="/3rdparty/highlight/styles/github.css">
    </head>

    <body class="article">
    
        <div class="header">
            <div class="inner">
                <ul class="clearfix">
                    <li><a href="/" class="home">Home</a></li>
                    <li><a href="/archive" class="archive">Archive</a></li>
                </ul>
            </div>
        </div>
    
        <div class="title-row">
    <div>
        <strong>Content with Style</strong>
        <p>Web Technique</p>
    </div>    
</div>


        <div class="content clearfix">
            <div class="main-col">
                <ul class="breadcrumb clearfix">
    <li class="home"><a href="/">Content with Style</a></li>
    <li><a href="/content/processing-the-output-buffer-with-xslt/index.html" class="active">Processing the output buffer with XSLT</a></li>
</ul>

<h1>Processing the output buffer with XSLT</h1>

<div class="info clearfix">
    <p class="credit">by Pascal Opitz on July 24 2005, 18:07</p>
</div>

<div class="article">
    <h2>The output buffer</h2>

<p>
Most programmers dealing with PHP will have come across various PHP errors when trying to do a redirect after an echo
or something similar.
</p>

<p>
The error usually looks like this:
</p>

<pre>
Warning: Cannot add header information - headers already sent by
(output started at /directory/to/starting_file.php:XXX) 
    in /directory/to/calling_file.php on line XX
</pre>

<p>
And for many of you that will have been the only application for the function <a href="http://uk2.php.net/manual/de/function.ob-start.php">ob_start</a>
which immediately fixes exactly these errors.
But most ignore that <em>ob_start</em> is just one function of a whole toolkit of functions that are referred to as <a href="http://uk2.php.net/manual/en/ref.outcontrol.php">&#8220;Output Control Functions&#8221;</a>, 
which provide a sophisticated toolkit for controlling and manipulating the output generated by PHP.
</p>

<h2>The callback function</h2>

<p>
The most powerful bit in this set of functions is definitely <em>ob_start</em> and it's optional parameter, the callback function.
This callback function will be called when the output is finally thrown. Using this it's easy to generate output and, for example, clean it afterwards with
HTML tidy, escape it, replace parts of it or replace all of it.
</p>

<p>
To show what I mean I'll provide a little class-based script as an example:
</p>

<pre>
&lt;?
class examplePage
{
  function examplePage()
  {
    ob_start(array($this,'parseOutput'));
    echo $this-&gt;getExampleXML();
  }

  function parseOutput()
  {
    $str = "&lt;pre&gt;" . htmlentities(ob_get_contents()) . 
        "&lt;/pre&gt; is the XML string we get from getExampleXML()";
    return $str;
  }  
  

  function getExampleXML()
  {
    $str = "&lt;root&gt;&lt;test&gt;Teststring&lt;/test&gt;&lt;/root&gt;";
    return $str;
  }
}

$example = new examplePage();

?&gt;
</pre>

<p>
As you can see the content thrown by the echo is parsed afterwards by the <em>parseOutput</em> method, and stuff gets added and escaped in one go.
</p>



<h2>Layered applications</h2>

<p>
This alone is a very powerful tool that can be used in pretty much every application that generates output with PHP, but we can push  it one step further. 
</p>

<p>
We'll use <em>XML as an intermediate application layer</em>.
The callback function will then process the whole output and render it through an XSL transformation.
</p>

<pre>
&lt;?
class examplePage
{
  function examplePage()
  {
    ob_start(array($this,'parseOutput'));
    echo $this-&gt;getExampleXML();
  }

  function parseOutput()
  {
    $this-&gt;xslt = xslt_create();

    $this-&gt;arguments['/_xml'] = ob_get_contents();
    $this-&gt;xmlDoc = 'arg:/_xml';


    $this-&gt;arguments['/_xsl'] = $this-&gt;getExampleXSL();
    $this-&gt;xslDoc = 'arg:/_xsl';

    return xslt_process($this-&gt;xslt, $this-&gt;xmlDoc, 
                    $this-&gt;xslDoc, NULL, $this-&gt;arguments);
  }  
  

  function getExampleXML()
  {
    $str = "&lt;root&gt;&lt;test&gt;Teststring&lt;/test&gt;&lt;/root&gt;";
    return $str;
  }


  function getExampleXSL()
  {
    $str = '&lt;?xml version="1.0" encoding="utf-8"?&gt;
      &lt;xsl:stylesheet version="1.0" 
	  	xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt; 
      
      &lt;xsl:template match="/"&gt;
        Test: &lt;xsl:value-of select="//test" /&gt;
      &lt;/xsl:template&gt; 
       
      &lt;/xsl:stylesheet&gt;
    ';

    return $str;
  }
}

$example = new examplePage();

?&gt;
</pre>

<p>
And here we go - dynamic processing of the XML-based application output.
This is obviously a raw example, and it needs integration in whatever framework you use, but hopefully you can see the power and flexibility of this technique.
</p>


<h2>Outlook</h2>

<p>
So what could this be useful for?
</p>
<p>
In my opinion this could give some web applications a whole new twist. One possibility for the techniques described 
would be to separate the presentation-related rendering process
into the step after the output. While your application is built to render XML and throw that into the PHP output, 
a separate method, maybe even a separate class, could handle this output and transform it into the right format.
</p>
<p>
The advantages are immediately obvious. Output rendering would become a reusable module and without it the application would
still output W3C-compliant XML code (<em>if you did everything right, that is</em>).
</p>

<p>
And again, this is just one possibility to use the callback function. Together with regular expressions or applications like
<a href="http://tidy.sourceforge.net/">Tidy</a> you could ensure that the output of dynamic data is valid. This could be useful for all people
who use variables to pass html-content into XSL templates.
</p>
</div>

            </div>
            
            <div class="sidebar">
                <div class="box info">
    <h2>Content with Style?</h2>
    
    <p>
        Content with Style is a London based blog, focusing on web technology and related topics.
    </p>
</div>
                <p class="rss-link">
    <a href="/atom.xml">Grab our feed</a>
</p>

                <div class="box date">
    <h2>Browse by Date</h2>
    <h3>2011</h3><ul class="clearfix"><li><a href="/archive/date/2011/March">March</a></li><li><a href="/archive/date/2011/January">January</a></li></ul><h3>2010</h3><ul class="clearfix"><li><a href="/archive/date/2010/December">December</a></li><li><a href="/archive/date/2010/November">November</a></li><li><a href="/archive/date/2010/October">October</a></li><li><a href="/archive/date/2010/September">September</a></li><li><a href="/archive/date/2010/August">August</a></li><li><a href="/archive/date/2010/May">May</a></li><li><a href="/archive/date/2010/April">April</a></li><li><a href="/archive/date/2010/March">March</a></li><li><a href="/archive/date/2010/January">January</a></li></ul><h3>2009</h3><ul class="clearfix"><li><a href="/archive/date/2009/November">November</a></li><li><a href="/archive/date/2009/October">October</a></li><li><a href="/archive/date/2009/August">August</a></li><li><a href="/archive/date/2009/July">July</a></li><li><a href="/archive/date/2009/June">June</a></li><li><a href="/archive/date/2009/May">May</a></li><li><a href="/archive/date/2009/April">April</a></li><li><a href="/archive/date/2009/March">March</a></li><li><a href="/archive/date/2009/February">February</a></li><li><a href="/archive/date/2009/January">January</a></li></ul><h3>2008</h3><ul class="clearfix"><li><a href="/archive/date/2008/December">December</a></li><li><a href="/archive/date/2008/November">November</a></li><li><a href="/archive/date/2008/October">October</a></li><li><a href="/archive/date/2008/September">September</a></li><li><a href="/archive/date/2008/August">August</a></li><li><a href="/archive/date/2008/July">July</a></li><li><a href="/archive/date/2008/June">June</a></li><li><a href="/archive/date/2008/May">May</a></li><li><a href="/archive/date/2008/April">April</a></li></ul><h3>2007</h3><ul class="clearfix"><li><a href="/archive/date/2007/December">December</a></li><li><a href="/archive/date/2007/November">November</a></li><li><a href="/archive/date/2007/October">October</a></li><li><a href="/archive/date/2007/August">August</a></li><li><a href="/archive/date/2007/July">July</a></li><li><a href="/archive/date/2007/June">June</a></li><li><a href="/archive/date/2007/May">May</a></li><li><a href="/archive/date/2007/April">April</a></li><li><a href="/archive/date/2007/March">March</a></li><li><a href="/archive/date/2007/February">February</a></li><li><a href="/archive/date/2007/January">January</a></li></ul><h3>2006</h3><ul class="clearfix"><li><a href="/archive/date/2006/November">November</a></li><li><a href="/archive/date/2006/October">October</a></li><li><a href="/archive/date/2006/September">September</a></li><li><a href="/archive/date/2006/August">August</a></li><li><a href="/archive/date/2006/July">July</a></li><li><a href="/archive/date/2006/June">June</a></li><li><a href="/archive/date/2006/May">May</a></li><li><a href="/archive/date/2006/April">April</a></li><li><a href="/archive/date/2006/March">March</a></li><li><a href="/archive/date/2006/February">February</a></li></ul><h3>2005</h3><ul class="clearfix"><li><a href="/archive/date/2005/October">October</a></li><li><a href="/archive/date/2005/September">September</a></li><li><a href="/archive/date/2005/July">July</a></li><li><a href="/archive/date/2005/June">June</a></li><li><a href="/archive/date/2005/May">May</a></li></ul>
</div>

            </div>
        </div>

        <ul>
          
        </ul>

        <div class="footer">
    <p class="bottom-logo">Content with Style</p>
    <p>Copyright 2006-2010 Content with Style, All rights reserved.</p>
</div>

<script type="text/javascript" src="/3rdparty/jquery/jquery-1.2.6.min.js"></script>
<script type="text/javascript" src="/3rdparty/highlight/highlight.pack.js"></script>
<script type="text/javascript" src="/default/js/cws_rev.REVISION.js"></script>

    </body>
</html>


---
layout : post
permalink : /content/unit-testing-controllers-with-zend-framework/index.html
author : "Pascal Opitz"
author_id : 1
title : "Unit testing controllers with Zend Framework"
date : "2009-04-02 14:47:48"
dateformatted : "April 2 2009, 14:47"
excerpt : |
    <p>Unit testing your Zend Framework driven MVC applications is not hard at all. This post tries to give a brief overview on how to test your Controllers with Zend_Test.</p>
categories : 
   - April 2009
   - "Pascal Opitz"
---

<p>Unit testing your Zend Framework driven MVC applications is not hard at all. This post tries to give a brief overview on how to test your Controllers with Zend_Test.</p>

<h2>Install PHPUnit</h2>

<p>Zend Framework integrates with PHPUnit. PHPUnit is a <a href="http://pear.php.net/">PEAR</a> module, and the usual way is to install PEAR that first and then <a href="http://www.phpunit.de/manual/current/en/installation.html">use the pear installer to install PHPUnit for you</a>.</p>

<h2>Create an application bootstrap include</h2>

<p>If you're using the <a href="http://framework.zend.com/manual/en/zend.controller.front.html">front controller pattern</a> and have all your variables set up in the index.php of your web folder, now is the time to <a href="http://framework.zend.com/docs/quickstart/create-a-bootstrap-file">move things into an include file</a>, before you create the controller and dispatcher. We'll use this very file when doing unit tests with Zend_Test</p>

<h2>Start Testing Controllers</h2>

<p>
With the help of Zend_Test we're now able to create tests that dispatch our controllers. We're then able to do assertions against the response, using the provided methods of the <a href="http://framework.zend.com/apidoc/core/Zend_Test/PHPUnit/Zend_Test_PHPUnit_ControllerTestCase.html">ControllerTestCase</a>.
</p> 

<pre><code>
class IndexTest extends Zend_Test_PHPUnit_ControllerTestCase
{
  public function setUp() {
    $this->bootstrap = array($this, 'appBootstrap');
    parent::setUp();
  }

  public tearDown() {
    $this->resetRequest();
    $this->resetResponse();
    parent::tearDown();
  }

  public function appBootstrap() {
    require_once('/my/bootstrap.php');
  }

  public function testHomepage() {
    $this->dispatch('/');
    $this->assertController('index');
    $this->assertAction('index');
    $this->assertXpath("//form[@action = '/foo']");
  }
}
</code></pre>

<h3>Manipulate the request, evaluate the response</h3>

<p>
Now that we've dispatched our controller, we can manipulate the request and access the response, to see what the dispatched action does. For example an action that requires post data, and then redirects us to another page:
</p>

<pre><code>
public testPostAction() {
  $request = $this->getRequest();

  $request->setMethod('POST');
  $request->setPost(array(
    'foo' => 'bar',
    'baz' => 'x',
  ));

  $this->dispatch('/my/post/action');
  $this->assertRedirectTo('/my/expected/redirect');
}
</code></pre>

<h3>Checking data manipulation</h3>

<p>
If we're working with data manipulations in our tests, we could use models to create the data we manipulate, and then to evaluate it after the controller has been dispatched. Finally we'll clean up after the test. Of course you'd want to have stable models at that point.
</p>

<pre><code>
public function testSave() {
  $my_id = $model->create();

  $request = $this->getRequest();
  
  $request->setMethod('POST');
  $request->setPost(array(
    'name' => 'unittest modified',
    'id' => $my_id,
  ));

  $this->dispatch("/save/object/");
  $this->assertRedirectRegex('#/edit/object/id/[\d]+$#');

  $data = $model->get($my_id);
  $this->assertEquals($data['name'], 'unittest modified');
  
  $my_id = $model->delete($my_id);  
}
</code></pre>

<h2>Related links</h2>

<ul>
<li><a href="http://framework.zend.com/manual/en/zend.test.html">Zend_Test Reference Guide</a></li>
<li><a href="http://devzone.zend.com/article/2772-An-Introduction-to-the-Art-of-Unit-Testing-in-PHP">An Introduction to the Art of Unit Testing in PHP</a></li>
<li><a href="http://blog.fedecarg.com/2008/12/27/phpunit-testing-zend-framework-controllers/">PHPUnit: Testing Zend Framework Controllers</a></li>
<li><a href="http://www.zfforums.com/zend-framework-general-discussions-1/installation-configuration-3/zend_test-how-set-up-1569.html">Zend_Test: how to set up?</a></li>
</ul>
